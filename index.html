<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coupeur - Belt-Tech</title>

  <!-- Favicons navigateur -->
  <link rel="icon" type="image/png" href="icons/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="icons/favicon.svg" />
  <link rel="shortcut icon" href="icons/favicon.ico" />

  <!-- Apple touch icon iOS -->
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Coupeur" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- PWA Android -->
  <link rel="manifest" href="icons/site.webmanifest" />
  <meta name="theme-color" content="#0175C2">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
      color: #333;
    }

    .app-header {
      background: #2196F3;
      color: white;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .app-header .icon { margin-right: 8px; font-size: 20px; }

    .container { padding: 20px; max-width: 800px; margin: 0 auto; padding-bottom: 0; }

    /* --- INPUTS --- */
    .input-section { display: flex; gap: 16px; margin-bottom: 24px; }
    .input-card {
      flex: 1; padding: 16px; border: 2px solid; border-radius: 12px; background: white;
    }
    .input-card.feuille { border-color: #FF9800; background: #FFF3E0; }
    .input-card.metier { border-color: #4CAF50; background: #E8F5E0; }

    .card-header { display: flex; align-items: center; justify-content: center; margin-bottom: 12px; }
    .card-header .icon { margin-right: 8px; font-size: 18px; }
    .card-title { font-size: 14px; font-weight: bold; text-align: center; flex: 1; }
    .feuille .card-title { color: #F57C00; }
    .metier .card-title { color: #388E3C; }

    .input-field {
      width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;
      font-size: 16px; font-weight: bold; text-align: center; background: white;
      margin-bottom: 12px;
      white-space: normal; overflow: visible; text-overflow: clip;
    }
    .input-field::placeholder {
      font-weight: normal; font-size: 14px; white-space: nowrap;
    }

    .btn {
      width: 100%; padding: 8px; border: none; border-radius: 4px;
      font-size: 12px; font-weight: bold; color: white;
      cursor: pointer; margin-bottom: 6px;
      display: flex; align-items: center; justify-content: center; gap: 4px;
    }
    .btn.feuille { background: #FF9800; }
    .btn.feuille.secondary { background: #FFB74D; }
    .btn.metier { background: #4CAF50; }
    .btn.metier.secondary { background: #81C784; }
    .btn.blue { background: #2196F3; }
    .btn.blue.secondary { background: #64B5F6; }

    /* --- CALCULS --- */
    .calculations-section {
      background: #F3E5F5; border: 2px solid #9C27B0;
      border-radius: 12px; padding: 16px; margin-bottom: 24px;
    }
    .section-header { display: flex; align-items: center; margin-bottom: 16px; }
    .section-header .icon { margin-right: 8px; color: #7B1FA2; font-size: 18px; }
    .section-title { font-size: 16px; font-weight: bold; color: #7B1FA2; }

    .calc-row { display: flex; gap: 12px; margin-bottom: 16px; }
    .calc-item {
      padding: 12px 16px; background-color: white;
      border: 1px solid #CE93D8; border-radius: 8px;
      text-align: center; display: flex; flex-direction: column;
    }
    .calc-item.piques { flex: 4; }
    .calc-item.cadence { flex: 4; }

    .calc-label { font-size: 12px; font-weight: bold; margin-bottom: 4px; }
    .calc-value { font-size: 20px; font-weight: bold; color: #9C27B0; }

    .dropdown {
      width: 100%; padding: 6px 4px; border: 1px solid #CE93D8;
      border-radius: 4px; font-size: 12px; background: white; text-align: center;
    }
		
		#cadenceSelect {
			font-size: 20px;      /* gros chiffre visible partout */
			font-weight: bold;
			padding: 6px 12px;
			border: 1px solid #CE93D8;
			border-radius: 4px;
			text-align: center;
			background: white;
		}
		#cadenceSelect option {
			font-size: 16px;      /* taille des options dans la liste */
			font-weight: normal;
		}

    .hours-remaining {
      width: 100%; padding: 12px 16px; background: white;
      border: 1px solid #CE93D8; border-radius: 8px;
      text-align: center; margin-bottom: 12px;
    }
    .hours-remaining .calc-label { color: #000; }
    .hours-remaining .calc-value { font-size: 18px; color: #9C27B0; }

    .finish-time { width: 100%; padding: 12px 16px; border-radius: 8px; position: relative; }
    .finish-time-content { display: flex; align-items: center; }
    .period-label { width: 40px; font-size: 24px; font-weight: bold; }
    .finish-time-center { flex: 1; text-align: center; }
    .finish-time-center .calc-label { font-size: 12px; font-weight: bold; }
    .finish-time-center .time-value { font-size: 24px; font-weight: bold; }
    .finish-time-spacer { width: 40px; }
    .strikethrough { text-decoration: line-through; text-decoration-thickness: 3px; }

    .green-bg { background: #2e7d32; color: white; }  /* Jour plus foncÃ© */
    .orange-bg { background: #FF9800; color: black; }
    .red-bg { background: #DC3545; color: white; }
    .purple-bg { background: #7B1FA2; color: white; }
    .blue-bg { background: #2196F3; color: white; }

    /* --- COUPE MANQUANTE --- */
    .coupe-manquante-section {
      background: #E3F2FD; border: 2px solid #2196F3;
      border-radius: 12px; padding: 16px; margin-bottom: 24px;
    }
    .coupe-manquante-section .section-header .icon { color: #1976D2; }
    .coupe-manquante-section .section-title { color: #1976D2; }
    .coupe-inputs { display: flex; gap: 16px; margin-bottom: 16px; }
    .coupe-input-group { flex: 1; }
    .coupe-input-label {
      font-size: 12px; font-weight: bold; color: #1976D2;
      margin-bottom: 8px; text-align: center;
    }

    /* --- FOOTER --- */
    .footer {
      background: #E3F2FD; border-radius: 8px;
      padding: 12px; text-align: center; margin-bottom: 70px;
    }
    .footer-title { display: flex; align-items: center; justify-content: center; margin-bottom: 4px; }
    .footer-title .icon { margin-right: 8px; }

/* SNACKBAR (pop-up en bas) */
.snackbar {
  position: fixed;
  bottom: 20px;
  left: 20px;
  right: 20px;
  padding: 16px;
  border-radius: 8px;
  color: white;
  font-weight: bold;
  z-index: 1000;
  display: none;
  text-align: center;
}

.snackbar.success { background: #4CAF50; }
.snackbar.warning { background: #FF9800; }

.snackbar.show {
  display: block;
  animation: slideUp 0.4s ease forwards;
}

.snackbar.hide {
  animation: slideDownFade 0.4s ease forwards;
}

/* Apparition */
@keyframes slideUp {
  from { transform: translateY(100%); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}

/* Disparition */
@keyframes slideDownFade {
  from { transform: translateY(0); opacity: 1; }
  to   { transform: translateY(100%); opacity: 0; }
}
    /* --- NUMPAD --- */
    #numpad {
      display: none; position: fixed; bottom: 0; left: 0;
      width: 100%; padding: 12px; background: #BA68C8;
      box-shadow: 0 -2px 12px rgba(0,0,0,0.3);
      border-top-left-radius: 16px; border-top-right-radius: 16px;
      z-index: 10000;
    }
    .numpad-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
    .numpad-btn {
      flex: 1; padding: 18px; border: none; border-radius: 12px;
      font-size: 26px; font-weight: bold; text-align: center;
      cursor: pointer; user-select: none;
      color: #9C27B0; background: #FFFFFF;
      transition: transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1),
                  filter 0.15s ease, box-shadow 0.15s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.15);
    }
    .numpad-btn.special { background: #4CAF50; color: white; }
    .numpad-btn.special.enter { background: #FF9800; color: white; }
    .numpad-btn:active {
      transform: scale(1.15); filter: brightness(1.2);
      box-shadow: 0 6px 10px rgba(0,0,0,0.25);
    }
    body.with-numpad { padding-bottom: 280px; }

    /* --- RESPONSIVE --- */
    @media (max-width:480px){
      .container{padding:10px;}
      .input-section{gap:10px;}
      .calc-row{gap:8px;}
      .coupe-inputs{gap:10px;}
      .dropdown{font-size:9px;padding:4px 2px;}
      .calc-label{font-size:11px;}
    }
  </style>
</head>
<body>

<div class="app-header"><span class="icon">âœ‚ï¸</span><span>Coupeur - Belt-Tech</span></div>

<div class="container">
<!-- Feuille et MÃ©tier -->
<div class="input-section">
<div class="input-card feuille">
<div class="card-header"><span class="icon">âœï¸</span><div class="card-title">FEUILLE</div></div>
<input type="number" id="handInput" class="input-field" placeholder="Prochaine coupe..." readonly>
<button class="btn feuille secondary" onclick="clearInput('hand')"><span>ğŸ”„</span>Reset</button>
</div>

<div class="input-card metier">
<div class="card-header"><span class="icon">âš™ï¸</span><div class="card-title">MÃ‰TIER</div></div>
<input type="number" id="machineInput" class="input-field" placeholder="Piques..." readonly>
<button class="btn metier secondary" onclick="clearInput('machine')"><span>ğŸ”„</span>Reset</button>
</div>
</div>

<!-- Calculations section -->
<div class="calculations-section">
<div class="section-header"><span class="icon">ğŸ“Š</span><div class="section-title">CALCULS DE COUPE</div></div>
<div class="calc-row">
<div class="calc-item piques"><div class="calc-label">Piques restantes</div><div class="calc-value" id="piquesRestantes">0</div></div>
<div class="calc-item cadence"><div class="calc-label">Cadence</div>
<select id="cadenceSelect" onchange="updateCalculations()">
    <option value="2000">2000 (120)</option>
    <option value="1900">1900 (114)</option>
    <option value="1850">1850 (111)</option>
    <option value="1800">1800 (108)</option>
    <option value="1750">ğŸğŸ•ğŸ“ğŸ (ğŸğŸğŸ“)</option>
    <option value="1700" selected>ğŸğŸ•ğŸğŸ (ğŸğŸğŸ)</option>
    <option value="1650">1650 (99)</option>
    <option value="1600">ğŸğŸ”ğŸğŸ (ğŸ—ğŸ”)</option>
    <option value="1500">ğŸğŸ“ğŸğŸ (ğŸ—ğŸ)</option>
    <option value="1400">1400 (84)</option>
    <option value="1300">1300 (78)</option>
    <option value="1150">1150 (69)</option>
    <option value="1000">1000 (60)</option>
    <option value="900">ğŸ—ğŸğŸ (ğŸ“ğŸ’)</option>
    <option value="800">800 (48)</option>
    <option value="750">750 (45)</option>
    <option value="700">700 (42)</option>
    <option value="450">450 (27)</option>
    <option value="200">200 (12)</option>
    <option value="165">165 (9)</option>
</select>
</div>
</div>

<div class="hours-remaining"><div class="calc-label">Heures restantes</div><div class="calc-value" id="heuresRestantes">0,00</div></div>
<div class="finish-time" id="finishTimeContainer">
<div class="finish-time-content"><div class="period-label" id="periodLabel"></div>
<div class="finish-time-center"><div class="calc-label">Heure de coupe</div><div class="time-value" id="heureCoupe">-- h --</div></div>
<div class="finish-time-spacer"></div></div></div>
</div>

<!-- Coupe Manquante -->
<div class="coupe-manquante-section" id="coupeManquanteSection">
<div class="section-header"><span class="icon">â•</span><div class="section-title">COUPE MANQUANTE</div></div>
<div class="coupe-inputs">
<div class="coupe-input-group"><div class="coupe-input-label">Duites coupÃ©es</div><input type="number" id="duitesCoupeesInput" class="input-field" placeholder="DerniÃ¨re coupe..." readonly></div>
<div class="coupe-input-group"><div class="coupe-input-label">Duites/coupe</div><input type="number" id="duitesParCoupeInput" class="input-field" placeholder="Haut de feuille..." readonly></div>
</div>
<button class="btn blue" onclick="calculerCoupeManquante()" data-allow-numpad-close>
  <span>ğŸ“Š</span>Calculer
</button>
<button class="btn blue secondary" onclick="resetCoupeManquante()" data-allow-numpad-close>
  <span>ğŸ”„</span>Reset
</button>
</div>

<!-- Footer -->
<div class="footer"><div class="footer-title"><span class="icon">âœ‚ï¸</span><span style="font-weight:bold;font-size:14px;">Coupeur, version 1.3.1</span></div><div style="font-size:12px;font-weight:bold;">ProgrammÃ© par Eric Delorme</div></div>
</div>

<!-- Snackbar -->
<div class="snackbar" id="snackbar"></div>

<!-- Numpad -->
<div id="numpad">
  <div class="numpad-row"><button class="numpad-btn" onclick="appendNumpad('7')">7</button><button class="numpad-btn" onclick="appendNumpad('8')">8</button><button class="numpad-btn" onclick="appendNumpad('9')">9</button></div>
  <div class="numpad-row"><button class="numpad-btn" onclick="appendNumpad('4')">4</button><button class="numpad-btn" onclick="appendNumpad('5')">5</button><button class="numpad-btn" onclick="appendNumpad('6')">6</button></div>
  <div class="numpad-row"><button class="numpad-btn" onclick="appendNumpad('1')">1</button><button class="numpad-btn" onclick="appendNumpad('2')">2</button><button class="numpad-btn" onclick="appendNumpad('3')">3</button></div>
  <div class="numpad-row"><button class="numpad-btn special enter" onclick="backspaceNumpad()">â†</button><button class="numpad-btn" onclick="appendNumpad('0')">0</button><button class="numpad-btn special" onclick="closeNumpad()">âœ”</button></div>
</div>

<script>
const optionValues = {
  '2000':120,'1900':114,'1850':111,'1800':108,'1750':105,'1700':102,
  '1650':99,'1600':96,'1500':90,'1400':84,'1300':78,'1150':69,
  '1000':60,'900':54,'800':48,'750':45,'700':42,'450':27,'200':12,'165':9
};

// Inputs
let activeInput = null;
['handInput','machineInput','duitesCoupeesInput','duitesParCoupeInput'].forEach(id => {
  const el = document.getElementById(id);
  el.addEventListener('focus', () => {
    activeInput = el;
    showNumpad();
  });
});
// Pour les boutons "Calculer" et "Reset" : fermer le numpad APRES que leur onclick se soit exÃ©cutÃ©.
// On laisse donc le mousedown global IGNORER ces boutons, puis on ferme via setTimeout aprÃ¨s le click.
document.querySelectorAll('[data-allow-numpad-close]').forEach(btn => {
  btn.addEventListener('click', () => {
    // ferme le numpad juste aprÃ¨s (permet Ã  l'onclick inline d'Ãªtre exÃ©cutÃ© en premier)
    setTimeout(() => {
      if (activeInput) closeNumpad();
    }, 0);
  });
});
// Numpad fonctions
function showNumpad(){ 
  const numpad = document.getElementById('numpad');
  numpad.style.display = 'block'; 
  document.body.classList.add('with-numpad'); 

  if (activeInput) {
    const coupeSection = document.getElementById('coupeManquanteSection');
    if (coupeSection && coupeSection.contains(activeInput)) {
      setTimeout(() => {
        coupeSection.scrollIntoView({
          behavior: 'smooth',
          block: 'start'   // aligne le bloc bleu en haut de lâ€™Ã©cran
        });
      }, 300);
    }
  }
}

function closeNumpad(){ 
  document.getElementById('numpad').style.display = 'none'; 
  document.body.classList.remove('with-numpad'); 
  activeInput = null; 
}
function appendNumpad(val){ if(!activeInput) return; activeInput.value += val; updateCalculations(); }
function backspaceNumpad(){ if(!activeInput) return; activeInput.value = activeInput.value.slice(0,-1); updateCalculations(); }

// Calculs
function updateCalculations(){
  const handValue = parseInt(document.getElementById('handInput').value) || 0;
  const machineValue = parseInt(document.getElementById('machineInput').value) || 0;
  const selectedCadence = document.getElementById('cadenceSelect').value;
  const piquesRestantes = handValue - machineValue;
  document.getElementById('piquesRestantes').textContent = piquesRestantes;
  
  let nombreHeures = 0;
  if(piquesRestantes > 0){ nombreHeures = piquesRestantes / optionValues[selectedCadence]; }
  document.getElementById('heuresRestantes').textContent = nombreHeures.toFixed(2).replace('.',',');
  updateFinishTime(nombreHeures);
}

function updateFinishTime(nombreHeures) {
  const finishTimeContainer = document.getElementById('finishTimeContainer');
  const periodLabel = document.getElementById('periodLabel');
  const heureCoupeEl = document.getElementById('heureCoupe');

  if (nombreHeures <= 0) {
    finishTimeContainer.className = 'finish-time purple-bg';
    periodLabel.textContent = '';
    heureCoupeEl.textContent = '-- h --';
    heureCoupeEl.className = 'time-value';
    return;
  }

  const maintenant = new Date();
  const heures = Math.floor(nombreHeures);
  const minutes = Math.round((nombreHeures - heures) * 60);
  const heureFin = new Date(maintenant.getTime() + (heures * 60 + minutes) * 60000);

  const heureFormatee = heureFin.getHours().toString().padStart(2, '0') +
    ' h ' +
    heureFin.getMinutes().toString().padStart(2, '0');
  heureCoupeEl.textContent = heureFormatee;

  const heure = heureFin.getHours();

  // DÃ©finir la limite de fin de journÃ©e (07h)
  let finDeJournee;
  if (maintenant.getHours() < 7) {
    // On est dans le shift de nuit â†’ limite = aujourd'hui 07h
    finDeJournee = new Date(
      maintenant.getFullYear(),
      maintenant.getMonth(),
      maintenant.getDate(),
      7, 0, 0
    );
  } else {
    // On est dans le jour ou le soir â†’ limite = demain 07h
    finDeJournee = new Date(
      maintenant.getFullYear(),
      maintenant.getMonth(),
      maintenant.getDate() + 1,
      7, 0, 0
    );
  }

  let shouldStrike = false;

if (heureFin >= finDeJournee) {
  // DÃ©passe la limite â†’ rouge barrÃ©
  finishTimeContainer.className = 'finish-time red-bg';
  shouldStrike = true;

  // Trouver quand mÃªme la pÃ©riode rÃ©elle du rÃ©sultat
  if (heure >= 7 && heure < 15) {
    periodLabel.textContent = 'JOUR';
  } else if (heure >= 15 && heure < 23) {
    periodLabel.textContent = 'SOIR';
  } else {
    periodLabel.textContent = 'NUIT';
  }

} else {
  // Encore dans la journÃ©e courante â†’ appliquer les couleurs normales
  if (heure >= 7 && heure < 15) {
    finishTimeContainer.className = 'finish-time green-bg';
    periodLabel.textContent = 'JOUR';
  } else if (heure >= 15 && heure < 23) {
    finishTimeContainer.className = 'finish-time orange-bg';
    periodLabel.textContent = 'SOIR';
  } else {
    finishTimeContainer.className = 'finish-time blue-bg';
    periodLabel.textContent = 'NUIT';
  }
}


  heureCoupeEl.className = shouldStrike ? 'time-value strikethrough' : 'time-value';
}



function clearInput(type){
  if(type==='hand') document.getElementById('handInput').value='';
  else document.getElementById('machineInput').value='';
  updateCalculations();
}

function calculerCoupeManquante() {
    const duitesCoupees = parseInt(document.getElementById('duitesCoupeesInput').value) || 0;
    const duitesParCoupe = parseInt(document.getElementById('duitesParCoupeInput').value) || 0;

    // Fermer le numpad immÃ©diatement
    closeNumpad();

    if (duitesCoupees > 0 && duitesParCoupe > 0) {
        const total = duitesCoupees + duitesParCoupe;

        // Mettre Ã  jour le champ Feuille
        document.getElementById('handInput').value = total.toString();
        document.getElementById('machineInput').value = '';

        // Vider les champs COUPE MANQUANTE
        document.getElementById('duitesCoupeesInput').value = '';
        document.getElementById('duitesParCoupeInput').value = '';

        // Recalculer
        updateCalculations();

        // Monter la page vers le champ Feuille
        document.getElementById('handInput').scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Afficher notification
        showSnackbar(`âœ… Total calculÃ©: ${total} ajoutÃ© Ã  la Feuille`, 'success');
    } else {
        // Si valeurs invalides â†’ juste notification, pas de scroll
        showSnackbar('âš ï¸ Veuillez entrer des valeurs valides dans les deux champs', 'warning');
    }
}



function resetCoupeManquante() {
    const duitesCoupeesInput = document.getElementById('duitesCoupeesInput');
    const duitesParCoupeInput = document.getElementById('duitesParCoupeInput');

    if (activeInput === duitesCoupeesInput) {
        duitesCoupeesInput.value = '';
    } else if (activeInput === duitesParCoupeInput) {
        duitesParCoupeInput.value = '';
    } else {
        // Aucun champ actif â†’ vider les deux
        duitesCoupeesInput.value = '';
        duitesParCoupeInput.value = '';
    }
}

function showSnackbar(msg, type = 'success', duration = 4000) {
  const el = document.getElementById('snackbar');

  // nettoyage si un snackbar Ã©tait dÃ©jÃ  en train d'Ãªtre montrÃ©
  if (el._hideTimer) {
    clearTimeout(el._hideTimer);
    el._hideTimer = null;
  }

  // texte + classes de base
  el.textContent = msg;
  el.classList.remove('show', 'hide', 'success', 'warning', 'error', 'info');
  el.classList.add(type);

  // rendre visible et forcer reflow pour relancer animation si nÃ©cessaire
  el.style.display = 'block';
  void el.offsetWidth; // <-- force reflow

  // lancer l'animation d'entrÃ©e
  el.classList.add('show');

  // timer pour cacher ensuite
  el._hideTimer = setTimeout(() => {
    // remplacer show par hide (l'animation de sortie jouera)
    el.classList.remove('show');
    el.classList.add('hide');

    // une fois la sortie finie, masquer dÃ©finitivement et nettoyer classes
    const onAnimEnd = () => {
      el.style.display = 'none';
      el.classList.remove('hide', type);
      el.removeEventListener('animationend', onAnimEnd);
    };
    el.addEventListener('animationend', onAnimEnd, { once: true });
  }, duration);
}

// Fermer le numpad si clic ailleurs (fix pour champs bas)
// Exception : on ne ferme PAS immÃ©diatement si le mousedown est sur un bouton marquÃ© data-allow-numpad-close
document.addEventListener('mousedown', (e) => {
  const np = document.getElementById('numpad');

  // 1) si clic dans le numpad => on ne ferme pas
  if (e.target.closest && e.target.closest('#numpad')) return;

  // 2) si clic dans un input => on ne ferme pas (on veut permettre la saisie)
  if (e.target.closest && (e.target.closest('input') || e.target.closest('.input-field'))) return;

  // 3) si mousedown sur un bouton "autorisÃ©" dans Coupe Manquante (Calculer / Reset),
  //    on NE FERME PAS ici : le bouton a son propre handler click qui fermera aprÃ¨s.
  if (e.target.closest && e.target.closest('[data-allow-numpad-close]')) {
    return;
  }

  // 4) sinon : comportement normal (fermer si on avait un input actif et le clic est Ã  l'extÃ©rieur)
  if (activeInput && (!np || !np.contains(e.target))) {
    closeNumpad();
  }
});

updateCalculations();
</script>

</body>
</html>
